<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastrar — MIX AWARDS</title>

  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">

  <style>
    /* ===== Reset/Correção ===== */
    * { box-sizing: border-box; }

    /* ====== estilos do modal ====== */
    .mw-modal{ position:fixed; inset:0; display:none; z-index:1050; }
    .mw-modal.is-open{ display:block; }
    .mw-modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter:blur(1px); }
    .mw-modal__dialog{
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:min(92vw,480px); background:#11293d; color:#e8f1f8;
      border-radius:16px; padding:22px 20px 20px;
      box-shadow:0 18px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow:hidden; /* corta brilho do focus */
    }
    .mw-modal__title{ margin:0 0 10px; font-size:1.25rem; text-align:center; }
    .mw-modal__close{
      position:absolute; right:10px; top:8px; width:36px; height:36px;
      border:0; border-radius:10px; cursor:pointer; background:transparent;
      color:#cfe8ff; font-size:22px; line-height:1;
    }
    .mw-modal__close:hover{ background:rgba(255,255,255,.06); }
    .mw-field{ display:block; margin:12px 0; width:100%; }
    .mw-field>span{ display:block; font-size:.9rem; color:#b9d4ea; margin-bottom:6px; }
    .mw-field>input{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid #1e3a53;
      background:#0f2233; color:#e8f1f8; outline:none; min-width:0;
    }
    .mw-field>input:focus{
      border-color:#56c1ff;
      outline: 3px solid rgba(86,193,255,.25); /* foco elegante */
      box-shadow:none;
    }
    .mw-btn{ width:100%; margin-top:10px; padding:12px; border:0; border-radius:10px; font-weight:700; background:#56c1ff; color:#072033; cursor:pointer; }
    .mw-btn:disabled{ opacity:.6; cursor:not-allowed; }
    .mw-msg{ min-height:18px; margin-top:10px; font-size:.92rem; }
    .mw-msg.error{ color:#ff9e9e; }
    .mw-msg.ok{ color:#9effb0; }
    .mw-row{ display:flex; gap:10px; }
    .mw-row > .mw-field{ flex:1 1 0; min-width:0; }
    @media (max-width:720px){ .mw-row{ flex-direction:column; } }
    .mw-actions{ display:flex; gap:10px; margin-top:12px; }
    .mw-btn.secondary{ background:#163750; color:#e8f1f8; }
    .hint{ color:#b9d4ea; font-size:.88rem; margin-top:4px; opacity:.9 }
  </style>
</head>
<body class="layout">
  <!-- NAVBAR (auth.js desenha aqui) -->
  <div class="nav"></div>
  <div class="page-pad"></div>

  <!-- Conteúdo “dummy” -->
  <main class="section">
    <div class="container">
      <div class="panel">
        <div class="title">CADASTRO</div>
        <p class="hint">Preencha seus dados no pop-up que abriu automaticamente.</p>
      </div>
    </div>
  </main>

  <!-- ===== Modal Cadastro ===== -->
  <div id="registerModal" class="mw-modal" aria-hidden="true" role="dialog" aria-labelledby="mwRegisterTitle">
    <div class="mw-modal__backdrop" data-close="true"></div>
    <div class="mw-modal__dialog" role="document">
      <button class="mw-modal__close" type="button" id="btnCloseRegister">×</button>
      <h2 id="mwRegisterTitle" class="mw-modal__title">Criar conta</h2>

      <form id="registerForm" novalidate>
        <label class="mw-field">
          <span>Nome</span>
          <input id="regNome" name="nome" type="text" maxlength="100" required placeholder="Seu nome completo" />
        </label>

        <label class="mw-field">
          <span>E-mail</span>
          <input id="regEmail" name="email" type="email" maxlength="100" required placeholder="voce@exemplo.com" />
        </label>

        <div class="mw-row">
          <label class="mw-field">
            <span>Senha</span>
            <input id="regSenha" name="senha" type="password" maxlength="100" required placeholder="••••••••" />
          </label>
          <label class="mw-field">
            <span>Confirmar senha</span>
            <input id="regSenha2" type="password" maxlength="100" required placeholder="••••••••" />
          </label>
        </div>

        <label class="mw-field">
          <span>Seu nick GC</span>
          <input id="regNomeNorm" name="nome_normalizado" type="text" maxlength="100" required placeholder="O NICK TEM QUE SER IGUAL" />
          <div class="hint">Você não poderá alterar o nick da GC enquanto rolar o Mix Awards</div>
        </label>

        <div class="mw-actions">
          <button id="btnDoRegister" class="mw-btn" type="submit">Criar conta</button>
          <a class="mw-btn secondary" href="/index">Cancelar</a>
        </div>
        <div id="registerMsg" class="mw-msg"></div>
      </form>
    </div>
  </div>

  <script>
    const registerModal = document.getElementById('registerModal');
    const btnCloseRegister = document.getElementById('btnCloseRegister');
    const registerForm = document.getElementById('registerForm');
    const regNome = document.getElementById('regNome');
    const regEmail = document.getElementById('regEmail');
    const regSenha = document.getElementById('regSenha');
    const regSenha2 = document.getElementById('regSenha2');
    const regNomeNorm = document.getElementById('regNomeNorm');
    const registerMsg = document.getElementById('registerMsg');
    const btnDoRegister = document.getElementById('btnDoRegister');

    function openModal(){ registerModal.classList.add('is-open'); regNome.focus(); }
    function closeModal(){ registerModal.classList.remove('is-open'); }

    btnCloseRegister.addEventListener('click', closeModal);
    registerModal.addEventListener('click', e=>{ if(e.target.dataset.close) closeModal(); });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

    // normalização
    const normalize = s => (s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim().toUpperCase();
    regNome.addEventListener('input', ()=>{ if(!regNomeNorm.dataset.touched) regNomeNorm.value = normalize(regNome.value); });
    regNomeNorm.addEventListener('input', ()=> regNomeNorm.dataset.touched = 1);

    registerForm.addEventListener('submit', async e=>{
      e.preventDefault();
      registerMsg.textContent=''; registerMsg.className='mw-msg';

      if(regSenha.value!==regSenha2.value){
        registerMsg.textContent='As senhas não conferem'; registerMsg.className='mw-msg error'; return;
      }
      const payload={ nome:regNome.value.trim(), email:regEmail.value.trim(), senha:regSenha.value, nome_normalizado:regNomeNorm.value.trim()||normalize(regNome.value) };
      btnDoRegister.disabled=true;
      try{
        const res=await fetch('/cadastrar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        const data=await res.json();
        if(!res.ok){ registerMsg.textContent=data?.mensagem||'Erro no cadastro'; registerMsg.className='mw-msg error'; btnDoRegister.disabled=false; return; }
        registerMsg.textContent=(data?.mensagem||'Cadastro ok!')+' '+(data?.resultados?.vinculo||''); registerMsg.className='mw-msg ok';
        setTimeout(()=>window.location.href='/index',1000);
      }catch(err){ registerMsg.textContent='Erro inesperado'; registerMsg.className='mw-msg error'; btnDoRegister.disabled=false; }
    });

    document.addEventListener('DOMContentLoaded', openModal);
  </script>

  <script src="/js/auth.js" defer></script>
</body>
</html>
